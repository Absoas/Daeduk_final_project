<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.common.board.freeboard.dao.IFreeboardDAO">
	
	<sql id="searchFrag">
		WHERE BOARD_TYPE = 3
		<trim suffixOverrides=" AND|OR ">
			<if test="searchVO!=null">
			AND
				<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchVO.mem_id)">
					mem_id LIKE '%'||#{searchVO.mem_id}||'%' OR
				</if>
				<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchVO.board_title)">
					board_title LIKE '%'||#{searchVO.board_title}||'%' OR
				</if>
				<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchVO.board_content)">
					board_content LIKE '%'||#{searchVO.board_content}||'%' OR
				</if>
			</if>
		</trim>
	</sql>
	

	<select id = "selectTotalRecord" parameterType="pagingVO" resultType="long">
		SELECT NVL(COUNT(*), 0)
		FROM BOARD
		<include refid="searchFrag" />
	</select>

	<select id="selectBoardList" parameterType="long" resultType="freeboardVO">
		SELECT B.*
		FROM (
		    SELECT ROWNUM RNUM, A.*
		    FROM (
		        SELECT BOARD_NO, BOARD_CONTENT, BOARD_TITLE,
		        		TO_CHAR(BOARD_DATE,'YYYY-MM-DD') BOARD_DATE, BOARD_VIEW_COUNT, 
		                BOARD_RECOMMEND_COUNT, MEM_ID
		        FROM BOARD
		        <include refid="searchFrag" />
		        ORDER BY BOARD_NO
		    ) A ) B
		WHERE RNUM BETWEEN #{startRow} AND #{endRow}
	</select>
	
</mapper>